"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.LiteratureTypeHandler=LiteratureTypeHandler;exports.GenreHandler=GenreHandler;exports.EditingHandler=EditingHandler;exports.WordCountHandler=WordCountHandler;exports.DeadlineHandler=DeadlineHandler;exports.EmailHandler=EmailHandler;exports.SubmitHandler=SubmitHandler;var _dynamic=require("../data/dynamic");var _create=require("./create");var _update_progress=require("../../shared/methods/update_progress");var _utilities=require("../../../../../../../global/methods/utilities");var __awaiter=void 0&&(void 0).__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}step((generator=generator.apply(thisArg,_arguments||[])).next());});};function LiteratureTypeHandler(event){event.path[1].nextElementSibling!==null&&event.path[1].nextElementSibling.remove();if(event.target.value!=="none"){let selectedLitPos=event.target.selectedIndex-1;_dynamic.userSelectedData.literatureType=event.target.selectedOptions[0].text;(0,_update_progress.Next)(1);const callbackFunc=this;callbackFunc(selectedLitPos);}else(0,_update_progress.Previous)(0);}function GenreHandler(event){event.path[1].nextElementSibling!==null&&event.path[1].nextElementSibling.remove();if(event.target.value!=="none"){_dynamic.userSelectedData.genre=event.target.selectedOptions[0].text;(0,_update_progress.Next)(2);const callbackFunc=this;callbackFunc();}else(0,_update_progress.Previous)(1);}function EditingHandler(event){event.path[1].nextElementSibling!==null&&event.path[1].nextElementSibling.remove();if(event.target.value!=="none"){let selectedEditingTypePos=event.target.selectedIndex-1;_dynamic.userSelectedData.editingType=event.target.selectedOptions[0].text;(0,_update_progress.Next)(3);const callbackFunc=this;callbackFunc(selectedEditingTypePos);}else(0,_update_progress.Previous)(2);}function WordCountHandler(event){event.path[1].nextElementSibling!==null&&event.path[1].nextElementSibling.remove();if(event.type==="keypress"&&event.charCode===13||event.type==="change"){let enteredValueStr=event.target.value;let enteredValueNum=parseInt(enteredValueStr);if(enteredValueNum>=event.target.min&&enteredValueNum<=event.target.max&&!(enteredValueStr==="")){let rates=this.data;let callbackFunc=this.callBack;_dynamic.userSelectedData.wordCount=enteredValueNum;let wordCountPos=rates.findIndex(rate=>enteredValueNum>=rate.min&&enteredValueNum<=rate.max);let currentRate=rates[wordCountPos];currentRate.flatRate&&(_dynamic.userSelectedData.pricing.flatRate=currentRate.flatRate);_dynamic.userSelectedData.pricing.perWord=currentRate.perWord;_dynamic.userSelectedData.pricing.perHour=currentRate.perHour;(0,_update_progress.Next)(4);callbackFunc();}else(0,_update_progress.Previous)(3);}}function DeadlineHandler(event){event.path[1].nextElementSibling!==null&&event.path[1].nextElementSibling.remove();let enteredDateStr=event.target.value;let enteredDateMs=Date.parse(enteredDateStr);let[minDate,maxDate]=(0,_create.getMinMaxDates)(new Date());if(enteredDateMs>=minDate.getTime()&&enteredDateMs<=maxDate.getTime()){_dynamic.userSelectedData.deadline=enteredDateStr;event.path[0].blur();(0,_update_progress.Next)(5);let callbackFunc=this;callbackFunc();}else(0,_update_progress.Previous)(4);}function EmailHandler(event){return __awaiter(this,void 0,void 0,function*(){event.path[1].nextElementSibling!==null&&event.path[1].nextElementSibling.remove();let emailStr=event.target.value;let errorMsg=event.path[0].nextElementSibling;console.log(event.keyCode);if(event.type==="keyup"&&event.keyCode===13||event.type==="change"){if(emailStr===""){errorMsg.innerHTML="*Required Field";}else{let emailReport=yield(0,_utilities.isValidEmail)(emailStr);if(emailReport.validEmail){errorMsg.innerHTML="*";_dynamic.userSelectedData.email=emailStr;let callbackFunc=this;callbackFunc();}else{let report=emailReport.report;errorMsg.innerHTML="*".concat(report.type);}}}});}function SubmitHandler(event){let submitBtn=event.path[0];let msg=submitBtn.nextElementSibling;let parent=event.path[1];let currentPricing;currentPricing=_dynamic.userSelectedData.pricing.flatRate!==0?"$".concat(_dynamic.userSelectedData.pricing.flatRate," flat rate"):(_dynamic.userSelectedData.pricing.perWord!==0?"$".concat(_dynamic.userSelectedData.pricing.perWord*_dynamic.userSelectedData.wordCount," + "):"")+"$".concat(_dynamic.userSelectedData.pricing.perHour,"/hour");let pricingStr="Your pricing will be: ".concat(currentPricing,"\nDo you wish to continue?\n\n");let formulaStr="*Formula calculated by:\n"+"($$/word * # of words) + $$/hour\n"+"-or-\n"+"$$ flat rate";if(confirm(pricingStr.concat(formulaStr))){let sendingImg=document.createElement("img");sendingImg.setAttribute("src","../../resources/pg_imgs/contact_imgs/sending_envelope.png");sendingImg.setAttribute("id","sending_img");parent.replaceChild(sendingImg,submitBtn);msg.innerHTML="Sending...";setTimeout(()=>{msg.innerHTML="Message Sent!";parent.replaceChild(submitBtn,sendingImg);},2000);setTimeout(()=>{let callbackFunc=this;callbackFunc();},5000);}}